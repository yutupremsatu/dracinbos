task genKeystore {
    doLast {
        def keystore = new File(project.projectDir, "app/dracinku-release.jks")
        
        // Find java home and keytool
        def javaHome = System.getProperty("java.home")
        def keytool = new File(javaHome, "bin/keytool.exe")
        if (!keytool.exists()) {
            keytool = new File(javaHome, "bin/keytool") // Try without exe
        }
        
        println "Using keytool: ${keytool}"
        
        if (!keystore.exists()) {
            println "Generating keystore: ${keystore.absolutePath}"
            exec {
                commandLine keytool, '-genkey', '-v', '-keystore', keystore.absolutePath, '-keyalg', 'RSA', '-keysize', '2048', '-validity', '10000', '-alias', 'dracinku', '-storepass', 'Gacor123', '-keypass', 'Gacor123', '-dname', 'CN=Dracinbos, OU=App, O=Dracinbos, L=Jakarta, S=Jakarta, C=ID'
            }
        } else {
            println "Keystore already exists!"
        }
        
        // Print SHA1
        def stdout = new ByteArrayOutputStream()
        exec {
            commandLine keytool, '-list', '-v', '-keystore', keystore.absolutePath, '-alias', 'dracinku', '-storepass', 'Gacor123'
            standardOutput = stdout
        }
        
        def sha1File = new File(project.projectDir, "sha1_release_result.txt")
        sha1File.text = stdout.toString()
        println "SHA-1 saved to ${sha1File.absolutePath}"
    }
}
